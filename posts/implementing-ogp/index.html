<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=noml name=robots><meta content="Jordan Glass" name=og:site_name><meta content="Open Graph allows for rich media previews with images and text - like this one! Here's how I added it to my Zola site." property=og:description><meta content=https://blog.jglass.me/posts/implementing-ogp/ property=og:url><meta content=images/ogp-cover.png property=og:image><meta content="Two images divided by a red horizontal stripe. Both are media previews for a webpage, but only the bottom one has a site name, description and image." property=og:image:alt><meta content=article property=og:type><meta content=en_GB property=og:locale><title>
         Implementing Media Previews with Open Graph Tags in Zola
        
    </title><meta content="Implementing Media Previews with Open Graph Tags in Zola" property=og:title><meta content="A blog on Cyber Security, Urban Design & Technology" name=description><meta content=2024-01-26T14:31:00Z name=article:published_time><link href=/icons/favicon.png rel=icon type=image/png><link href=https://blog.jglass.me/fonts.css rel=stylesheet><link title="Jordan Glass" href=https://blog.jglass.me/atom.xml rel=alternate type=application/atom+xml><link href=https://blog.jglass.me/theme/light.css rel=stylesheet><link href=https://blog.jglass.me/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://blog.jglass.me/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://blog.jglass.me>Jordan Glass</a><div class=socials><a class=social href=https://github.com/Jordan-Glass/> <img alt=github src=/social_icons/github.svg> </a><a class=social href=https://fosstodon.org/@JordanGlass rel=me> <img alt=mastodon src=/social_icons/mastodon.svg> </a><a class=social href=https://www.linkedin.com/in/jordan-g-b26288261/> <img alt=linkedin src=/social_icons/linkedin.svg> </a><a class=social href=/atom.xml> <img alt=rss src=/social_icons/rss.svg> </a></div></div><nav><a href=/posts style=margin-left:.7em>/posts</a><a href=/code style=margin-left:.7em>/code</a><a href=/contact style=margin-left:.7em>/contact</a><a href=/about style=margin-left:.7em>/about</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://blog.jglass.me/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Implementing Media Previews with Open Graph Tags in Zola<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta> Posted on <time>26 January 2024</time><br> By Jordan Glass</div></div><section class=body><p>The <a href=https://ogp.me/>Open Graph Protocol</a>, or OGP, is a series of <code>&LTmeta></code> tags designed to provide metadata about content hosted online, including articles, photos, and videos. It's created by Facebook, which would normally be a big red flag for me - but since it's an open standard, other sites have embraced it too, including Microsoft's LinkedIn and the decentralised Mastodon.<p>Platforms use OGP data to display rich information alongside webpages their users link to, including photos, bespoke headlines that differ from the page's actual title, and descriptions to elaborate on both of them.<p>Four tags are required as a baseline: <span id=continue-reading></span><ul><li><code>og:title</code>, to define the title displayed in social feeds;<li><code>og:type</code>, such as <code>website</code> or <code>article</code>;<li><code>og:image</code>, to represent the content visually; and<li><code>og:url</code>, used as a permanent, fixed identifier.</ul><p>It also supports many more. I'll be using:<ul><li><code>og:description</code>, to elaborate upon the title and describe what the article is about;<li><code>og:image:alt</code>, used to describe what's in the cover image; and<li><code>og:locale</code>, to define the language the article is written in.</ul><p>Platforms have to guess how to display pages that don't provide this metadata. Some do a better job than others: Mastodon uses the page's <code>&LTtitle></code> tag and omits any images, as you'd expect, while LinkedIn uses the first <code>&LTh1></code> tag and image it can find, which can be confusing since you're not meant to see them until you click through!<p><img alt="A LinkedIn post which links to a webpage. The preview card picks the first image, of a submodule on GitHub.com, and the first heading, INSTALLING ZOLA, as its preview." async src=images/linkedin-preview-before.png width=662px><p>I want my posts to stand out a little more than that, so last month I decided to implemement Open Graph tags on this blog. Here's how I did it.<h1 id=existing-functionality>Existing Functionality</h1><p>Since I first created this blog in January 2022, the Apollo theme has received a few updates and improvements from its contributors. <a href=https://github.com/not-matthias/apollo/pull/16>One of them</a> added OGP support, <a href=https://github.com/not-matthias/apollo/pull/16/commits/8e790b49272ed8528b9ae6d66c677c0ca33fc0f7#diff-842f32fea346a4b69719f7b55b8b0b3aa2d86d992ea90814cd9b6234ce6d54c8>automatically adding</a> the <code>og:title</code> and <code>og:description</code> tags based on the page's <code>title</code> and <code>description</code>, defined in the <a href=https://www.getzola.org/documentation/content/page/#front-matter>TOML</a>, and <a href=https://github.com/not-matthias/apollo/pull/16/commits/8e790b49272ed8528b9ae6d66c677c0ca33fc0f7#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5>adding any other tags</a> explicitly defined there.<p>It does this by looping through the list of tags you defined and, for each one, adding a <code>&LTmeta></code> tag with your <code>key</code> and <code>value</code> in place of the placeholders <code>{{ key }}</code> and <code>{{ value }}</code>. If you defined a title or description, it sets a variable accordingly, and won't add another automatically.<pre class=language-tera data-lang=tera style=background:#0f1419;color:#bfbab0><code class=language-tera data-lang=tera><span>{% if page.extra.meta %}
</span><span>     &LT!-- the meta data config goes here  -->
</span><span>     {% for data in page.extra.meta %}
</span><span>         &LTmeta 
</span><span>             {% for key, value in data%}
</span><span>                 {% if key == "property" and value == "og:title"%}
</span><span>                     {% set_global page_has_og_title = true -%}
</span><span>                 {% endif %}
</span><span>                 {% if key == "property" and value == "og:description"%}
</span><span>                     {% set_global page_has_og_description = true -%}
</span><span>                 {% endif %}
</span><span>                 {% if key == "name" and value == "description"%}
</span><span>                     {% set_global page_has_description = true -%}
</span><span>                 {% endif %}
</span><span>                 {{ key }}="{{ value }}"
</span><span>            {% endfor %}
</span><span>        />
</span><span>    {% endfor %}
</span><span>{% endif %}
</span></code></pre><blockquote><p><em>The title and description tags are set automatically later in <a href=https://github.com/Jordan-Glass/blog.jglass.me/blob/main/templates/partials/header.html>this file</a> if the relevant variables aren't set here with <code>set_global</code>.</em></blockquote><p>This functionality is good, but I'd like to use other tags - including the <code>image</code> and <code>url</code> ones required by the protocol. I also want to add defaults where I can, to be used if I forget to add them. So, I needed to change this functionality to suit the way I need it to work.<h2 id=updating-the-apollo-theme>Updating the Apollo theme</h2><p>Before that, I had to bring my copy of the Apollo theme up to date, importing the implementation of OGP that it already provides. I downloaded the latest Apollo theme from GitHub and placed it into a new folder alongside the existing one I hadn't updated yet, to make sure that I could quickly reverse any changes if they broke anything.<p>I then merged the changes I had already made - in the <code>/templates</code> directory in the root of my blog folder - with the new versions of the relevant files: <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/47b487465570be8eb212a3492fb7c3d53bfc5df5><code>macros.html</code></a>, <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/3f88471bff5c9729afbb53be8d3096fe414f5fd9><code>nav.html</code></a> and <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/cd705031ff9f437fdeb6e8c89dab179bb89b1610><code>header.html</code></a>. In the process, I made sure to add a comment next to all the changes so I could pick them out a bit more easily.<p>Finally, I swapped the theme the blog used to the new <code>apollo-new</code> folder, with the theme I'd just downloaded, and used <code>zola serve</code> to check how it worked.<p>With everything working as expected, I could pull the changes the "proper" way. Since I initially installed the theme using Git Submodules, as its <a href=https://github.com/not-matthias/apollo#installation>installation instructions</a> recommended, I could simply tell Git to pull all the changes that have been made since I installed it with <code>git submodule update --remote</code>.<p><img alt="Linux terminal running git submodule update, with the remote flag, on the apollo subdirectory within themes." async src=images/submodule-update.png width=723px><p>This downloads all the commits made to the theme that I'm missing, and updates the file that tracks the latest one I've downloaded. Here, you can see it remove the line referring to <a href=https://github.com/not-matthias/apollo/commit/b0ad81c2ded4e3c7defda047f8ae6f1ebfcdc96c>the old commit</a> and replace it with a reference to <a href=https://github.com/not-matthias/apollo/commit/4088ea216ca9cf80244593a8ea2879c981b037db>the new one</a>.<blockquote><p><em>Click through to either of these commits, or hover to check their URLs, and you'll see they have the same IDs as you see in the photo below! Git refers to commits uniquely using their SHA-1 checksum, which is what you're seeing here. You'll see the first few characters of these checksums in <a href=https://github.com/Jordan-Glass/blog.jglass.me/commits/main/>my blog's commit history</a>.</em></blockquote><p><img alt="Linux terminal running git diff, with the cached flag, resulting in one change to one file: a line referring to subproject commit b0ad81c is removed, and a reference to 4088ea2 is added." async src=images/submodule-diff.png width=540px><p>There's a more complex way to do this, but I chose this easier one! You can see all the instructions around updating submodules <a href=https://git-scm.com/book/en/v2/Git-Tools-Submodules#_pulling_in_upstream_changes_from_the_submodule_remote>here</a>, and my commit updating them <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/4a249ea65b42884c07bf8cb6a8b0daf0df55a4ea>here</a>.<h2 id=how-does-it-look-now>How does it look now?</h2><p>A Flatpak app called <a href=https://flathub.org/apps/com.rafaelmardojai.SharePreview>Share Preview</a> allows me to simulate what my posts will look like on a social network without having to publish my work-in-progress to the Internet and check for real.<p>With my existing changes ported over and merged with the changes to the Apollo theme adding OGP support, the title will now work reliably - and I can now add a description if I'd like to. That's a little better than before, but I can do better.<p><img alt="Media preview in Share Preview. The title is correct, but there is no cover image, description, or site name." async src=images/share-before.png width=514px><h1 id=making-changes>Making Changes</h1><p>Many of the tags I wanted to implement were simply extensions of the existing functionality built-in to Apollo, but there were some more complicated elements too.<h2 id=image-type>Image & Type</h2><p>Each page needs a preview image and type as part of the OGP spec. Manually setting the type as an article in each post isn't much work, but I wanted to define a generic default image in case I couldn't (or forgot to) make one for the page I'm sharing.<p>Since I'm no expert in professional-grade image software - and this image didn't need to be particularly elaborate anyway - I created it in PowerPoint, matching the colours and font to that of the blog itself, and <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/deaad0293acc4454029a0d0eca8d4d48cfc9ff26>put it in the <code>/static</code> folder</a>.<p><a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/e80c00acdec6971af8d282049b726993df3b7d7c>A default <code>og:type</code></a> wouldn't go amiss either: the generic <code>website</code> value is ideal for this, as pages with no type specified should be treated as if it had this tag anyway.<p>Both of these changes involved adding a check detecting whether another type or image had been specified in the post's TOML front matter, and adding the generic <code>og:type</code> or <code>og:image</code> tags if they were missing - very similar behaviour to the existing checks for the title and description included in Apollo.<p><a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/a80ffe9e35ee6a370e1578303dd104bf304547b1>The default image</a> could be referenced simply with <code>/cover.png</code>, omitting the <code>/static</code> prefix. I later needed to <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/2b42387985e40ee9477e667704f365cda310a8e4>fix</a> the <code>og:image</code> check, however, as I forgot to change it to use the correct variable after copying the code from the <code>og:type</code> implementation.<p>Like with every change, after implementing it, I used <code>git add</code> to stage the file, <code>git diff --cached</code> to review what I'd changed, and finally <code>git commit</code> once I was sure there was nothing amiss.<p><img alt="Linux terminal: git add is used to stage the header.html template, git diff shows that one line was changed, and git commit was used to commit the change (commit 2b42387)." async src=images/git-add-diff-commit.png width=726px><blockquote><p><em>I prefer to use <code>git commit</code> without flags, unlike many tutorials. Specifically, <code>-m</code> is often mentioned, allowing you to define a comment from the shell, rather than a text editor like <code>nano</code>. I prefer the latter: it allows me to add some more text underneath the title elaborating on the change I've made, like in <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/b307f66bb08f9bd658ffc2169b7612873ef2a6e4>this commit</a>. Similarly, <code>-a</code> stages all changed files for commit, which breaks the one-change-per-commit rule I first learned from <a href="https://youtu.be/f7xZivqLZxc?si=xQ6N6nXXWvgiE2su&t=391">Chris Titus</a> and still aim to follow now.</em></blockquote><h2 id=authors-dates>Authors & Dates</h2><p>A few more of the changes are around the information you now see underneath the title on each post: the publication date, which was always there; the update date, which I added; and the article's authors, which I wanted to show alongside them.<p>I had already <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/280ecfd0ec2a8e8069344b1bf4d48ad0692bb718>re-formatted</a> how dates are displayed in the Apollo theme, including adding the post update date alongside the publication date, <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/47b487465570be8eb212a3492fb7c3d53bfc5df5>porting the changes over</a> and moving the date below the post title when I updated the theme earlier.<p>Since I'm certain to define a publication date for each post, it made sense to <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/91d24ec4be71c9c60a3e63284ab237158d75b76c>use them as Open Graph publication and update times too</a>.<p>I added a check alongside the existing ones for the <code>og:type</code> and <code>og:image</code> tags so that the dates would only be added to articles: it didn't make much sense to add them to static pages I won't be changing much. I later had to <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/9f89ad2455cba7555f3e1483f5d9644e129ce90b>fix</a> these tags to use the <code>article:</code> prefix instead of <code>og:</code>.<p>Adding authors' names under the title was a little more complex. I originally wanted to add some logic to replace instances of <code>default</code> in the authors list with the author defined in the global blog configuration, <code>config.toml</code>. This implementation would allow that name to be changed without having to change it in each individual post - reducing data redundancy, similar to how a well-normalised relational database should work. In preparation, I <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/e1efed69423781e604a11b2c46201a6a091dd138>added my name</a> to that configuration file so it could be shown on any pages that needed it, and had <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/0c61e785e43d71a501d5c31c72a9dc21c3820776>already added them</a> to the existing posts.<p>I had entirely implemented this logic when I realised that the RSS feed would now show "default" as the author, instead of my name. You can see the implementation I had to replace in this image:<p><img alt="GEdit text editor, Linux (Pop OS 22.04). Logic to add a list of authors to the post header alongside the publication date. A for loop works through the authors. If one is `default`, it is substituted for the blog's author." async src=images/authors-default.png width=669px><p><a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/6c154852aee6903ea5d5927a84792dbc52f4fd65>I removed the checks for any "default" authors, and simplified the logic</a>. Using <code>for</code> and <code>if</code>, the logic adds a comma to separate the authors on each loop except the first, as well as <code>and</code> on the last loop - as long as it's not also the first, since reading "By and Jordan Glass" wouldn't look particularly good.<p>Using percentage symbols and hyphens around Tera logic allows you to control whitespace: <code>%-</code> at the start of a statement removes all whitespace before it, while <code>-%</code> at the end removes all whitespace after it. Omitting hyphens will change nothing.<p>I used this behaviour, together with whitespace before <code>and</code> as well as the author placeholder, to ensure that the text was spaced correctly when it appeared on the blog.<h1 id=getting-ready>Getting Ready</h1><p>Before I take a look at the final product, there are a few miscellaneous things I had to do first.<p>Code to add an <code>og:description</code> tag was already present in Apollo before I made my changes, but I hadn't added a site description for it to use as a default - a problem <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/80234bd9935ae861fc00de94acc21fb37fafe1ac>I've now fixed</a>.<p>I also needed to make some changes to my existing blog posts (<a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/97d7f0be7ff9d8c84e2dd693cd799037cccc9ee3>1</a>, <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/63fec89d9897de50d7bda2d719c98a14e7a90d1f>2</a>, <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/8829f92fb7f8ab3704ed1faf6390f364a4caa131>3</a>) to define the tags which aren't added automatically: specifically, the <code>description</code>, <code>url</code>, <code>image</code> and <code>type</code> tags. URL and type are easy: I know the URL the post will end up having as it's derived from the file name, and the type will always be <code>article</code>. The description takes a little more thought - I prefer it to summarise the overall point of the post, rather than introduce it. The image is the most difficult: the post might not have any images I can use already, and I wouldn't want to use them regardless. I want to use something representative of the whole post, such as <a href=https://blog.jglass.me/posts/getting-started-with-zola-part-1/markdown-cover.png>my first post's cover</a>, not an existing image that's reliant on the context it appears within.<p>I also implemented some more tags that I discovered later: specifically, <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/f476fe02b5382d749958e1f1a983f291bf82c913><code>og:site_name</code></a> to define the name of the site, pulled directly from the configuration file - an alternative, of sorts, to the <code>profile</code> tags for authors I didn't implement; and <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/99b97bb7d54c2766da9e0945b599a4a16d4a9d2c><code>og:locale</code></a>, included in each post to define its language.<p>Finally, I also <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/a01340571f650cd4c598fad2b67237dbbfea4f7f>better described</a> the changes I've made to Apollo - and how to spot them - in the repository's <code>README.md</code> file.<h2 id=accessibility-privacy-performance>Accessibility, Privacy & Performance</h2><p>Outside of adding the OGP tags, I added <code>alt</code> tags to the <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/5a60bb9cd775d2b08225f89071620dd4bce8b6ae>site</a> and <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/bee3e690c8f6a3b415c484508b2f9fa3eddb4305>post</a> cover images, removed external <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/074a4591c89661eb2804476d29a43c3ba3fc9de6>fonts</a> and <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/105377ae7a9aa6e3da8e36e83c8c1ab55d9c7acb>analytics</a> code from the Apollo templates since I had no use for it, and ran <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/3accffd64e95b4057d93783eb0d2cb257a3addc7>a couple</a> <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/d623662ea2bc90831b7a60baaba27094c1d33b70>of images</a> through ImageMagick to compress them.<h1 id=in-review>In Review</h1><p>With all those changes implemented and working, how will posts appear in media previews now? Share Preview has the answer:<p><img alt="Media preview in Share Preview. A bespoke cover image is used, specific to the post linked, and a description and site name are shown." async src=images/share-after.png width=516px><p>A huge improvement!<p>It guarantees that the title will appear correctly, and gives me the flexibility to explicitly set a different one for previews than appears on the blog itself. It gives each post its own preview image and description to summarise what you're about to read, and puts the site name in the corner too.<p>I'm not doing this for clicks or views. I don't even know how many visits this blog has - it could be none for all I know - but implementing OGP has transformed it from looking like a token project I don't really care about to looking like it might actually be worth your attention, putting it on the same level as more established outlets' presence in your feeds.<p>A small change, and an effective one - and all using a protocol developed by Facebook. I didn't see that coming!<hr><h1 id=related-on-the-internet>Related on the Internet</h1><ul><li><a href=https://gist.github.com/Zekfad/f51cb06ac76e2457f11c80ed705c95a3>Conventional Commits</a>: a list of terms to prefix commit descriptions with to make it clearer what the change actually is. GitHub <a href=https://github.com/Jordan-Glass/blog.jglass.me/commit/f2438ebafe52eee5a9029dce6ca692fbf0b63933>automatically created</a> a commit titled <code>Create zola.yml</code> when I was first publishing this blog to the Internet, so I assumed that a style like that was conventional - but this seems much better!<li><a href=https://christitus.com/using-github-correctly/>Using GitHub Correctly</a>: The text version of the video by Chris Titus that I linked above on including only one change in each commit. The <code>gh</code> utility is certainly useful, but I can't vouch for using command aliases to commit and push everything in one go. I prefer having more control than that, even if it takes longer!<li><a href=https://www.freecodecamp.org/news/git-and-github-workflow-for-open-source/>How to Contribute to Open-Source Projects</a>: A tutorial on forking and submitting pull requests on GitHub. I've taken a first look at this, and hopefully at some point I might be able to make some contributions somewhere.<li><a href=https://keats.github.io/tera/docs/>Tera Documentation</a>: Information on logic and features you can use in your Zola templates, including <code>for</code>, <code>if</code> and <code>length</code>, as well as whitespace control.</ul><hr><ul><li><a href=https://github.com/Jordan-Glass/blog.jglass.me/tree/main/content/posts/implementing-ogp/index.md>View post source</a></ul></section></article></main></div>